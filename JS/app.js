



let normalParagraphs = [
    "the sky is vast and blue a canvas stretching endlessly above the world clouds drift lazily casting shadows on the earth the sun shines bright and warm a source of light and life for all beings on this planet birds soar through the air their wings outstretched in graceful arcs as they ride the currents of the wind below the ground is solid and firm the soil rich with nutrients that sustain the plants and trees that cover the landscape rivers flow steadily carving paths through the terrain their waters meandering and twisting as they journey toward the sea",
    "the ocean is a vast expanse of water that stretches beyond the horizon its waves crash against the shore with a rhythmic and soothing sound the sand beneath your feet is soft and warm a reminder of the earth's natural beauty and diversity in the distance mountains rise majestically into the sky their peaks reaching towards the heavens a testament to the power and grandeur of the natural world the air is filled with the scents of flowers and trees a symphony of fragrances that dance on the breeze",
    "in the forest, trees stand tall and proud their branches reaching for the sky leaves rustle in the wind creating a gentle melody that permeates the air sunlight filters through the canopy above casting dappled shadows on the forest floor a carpet of fallen leaves crunches underfoot as you walk through the woods animals scurry and chirp hidden in the underbrush their presence felt more than seen the forest is a sanctuary a place of peace and tranquility where the hustle and bustle of the outside world fade away",
    "the city is a bustling hive of activity people rush through the streets on their way to work or school cars honk and buses roar as they navigate the crowded roads skyscrapers tower above casting shadows on the sidewalks below the air is filled with the sounds of conversation and the hum of city life neon lights flash and signs glow in a cacophony of colors and shapes the city never sleeps always alive with the energy of its inhabitants",
    "the desert is a vast and empty landscape stretching for miles in every direction the sand is hot beneath the blazing sun mirages shimmer on the horizon playing tricks on the eyes the air is dry and arid a stark contrast to the watery landscapes of other regions cacti stand tall and proud resilient in the face of harsh conditions the desert is a place of extremes where the temperature can soar during the day and plummet at night yet despite its challenges, life persists",
    "the jungle is a dense and lush wilderness teeming with life plants grow in abundance creating a verdant carpet that covers the forest floor vines dangle from the trees like nature's own curtain monkeys swing from branch to branch their calls echoing through the treetops insects buzz and chirp in a symphony of sound the jungle is a vibrant and chaotic ecosystem where every creature plays a role in the delicate balance of nature",
    "the Arctic is a frozen expanse of ice and snow a vast white wilderness that stretches as far as the eye can see temperatures plummet to bone-chilling levels as the icy wind whips through the air polar bears roam the frozen landscape in search of food seals swim beneath the ice in the frigid waters the Northern Lights dance across the night sky a breathtaking display of colors that illuminates the cold darkness of the Arctic",
    "the rainforest is a lush and humid environment where the air is thick with moisture and the scent of earth and vegetation tropical plants with vibrant blooms create a riot of color monkeys swing through the trees with agile grace and birds with exotic plumage flit through the canopy above the rainforest is a treasure trove of biodiversity with countless species of plants and animals coexisting in a delicate web of life",
    "the mountains are a majestic and awe-inspiring sight their peaks reaching towards the heavens snow-capped and towering over the landscape rivers carve through the valleys below creating breathtaking vistas at every turn the air is crisp and thin as you ascend higher into the mountains the sound of rushing water echoes through the rocky terrain and the views from the summit are nothing short of spectacular",
    "the beach is a serene and tranquil retreat where the waves gently lap against the shore seagulls call overhead as they glide on the breeze the sand is cool between your toes and the salty scent of the ocean fills the air shells and seaweed wash ashore leaving behind a trail of treasures for beachcombers to discover the beach is a place of relaxation and rejuvenation where the worries of everyday life are washed away by the tide",
    "the meadow is a vast expanse of grass and wildflowers stretching out in all directions the sun bathes the landscape in a warm golden glow butterflies flit from flower to flower and bees buzz busily as they collect nectar from the blooms the meadow is a peaceful oasis where time seems to slow and the beauty of the natural world is on full display",
    "the canyon is a deep and rugged chasm carved by the forces of nature over countless years towering cliffs rise on either side creating a breathtaking panorama of rock and sky the sound of rushing water echoes through the canyon as a river winds its way through the bottom the colors of the canyon walls shift and change with the angle of the sun casting shadows and highlights that accentuate its natural beauty",
    "the tundra is a vast and desolate landscape where the ground is frozen solid for much of the year temperatures can be brutally cold and only the hardiest of plants and animals can survive in these harsh conditions the tundra is a place of extremes where the sun never sets in the summer and darkness reigns for months on end in the winter",
    "the savanna is a sweeping grassland dotted with acacia trees and teeming with wildlife elephants roam in herds while lions laze in the shade of a baobab tree the savanna is a place of constant motion as animals migrate in search of water and food the air is filled with the sounds of hooves and the distant roars of predators the savanna is a testament to the resilience and adaptability of life in the natural world",
    "the marsh is a wetland teeming with life and activity frogs croak in chorus as they navigate the water lilies and dragonflies flit through the air in a delicate dance the marsh is a haven for waterfowl who build their nests among the reeds and use the water as a source of food and protection despite its muddy and sometimes inhospitable appearance, the marsh is a vital ecosystem that supports a diverse array of plant and animal life",
    "the prairie is a vast and open landscape where the grass stretches out in every direction the wind blows across the plains creating waves of movement in the sea of green the prairie is home to a variety of animals from bison to prairie dogs who make their homes in burrows beneath the ground the sky above is wide and expansive with clouds drifting lazily by",
    "the volcano is a formidable and powerful force of nature molten lava flows from its summit carving a path of destruction as it goes the air is thick with smoke and ash and the ground trembles beneath your feet the volcano is both a destructive and creative force shaping the landscape in its fiery wake",
    "the cave is a dark and mysterious place where the only light comes from the glow of phosphorescent rocks and the echo of dripping water fills the air stalactites hang from the ceiling like nature's chandeliers and stalagmites rise from the ground in jagged formations the cave is a world unto itself, hidden beneath the surface and shrouded in darkness",
    "the canyon is a narrow and winding passage carved by the flow of water over centuries sheer cliffs rise on either side creating a dramatic and awe-inspiring landscape the echoes of your footsteps reverberate through the canyon as you navigate its twists and turns the play of light and shadow on the canyon walls creates a dynamic and ever-changing tableau",
    "the oasis is a verdant and lush sanctuary in the midst of a barren desert palm trees sway in the breeze casting shade over a pool of crystal-clear water the air is cool and refreshing, a stark contrast to the arid surroundings the oasis is a haven for wildlife who come to drink from its waters and seek respite from the harsh conditions of the desert"
];

let panctuParagraphs = [
    "The sun sets on the horizon, painting the sky with hues of orange and pink. A gentle breeze rustles the leaves, creating a soothing melody. Birds return to their nests, chirping their goodnight songs. The world quiets down, preparing for the embrace of night. Stars twinkle above, like diamonds scattered across the dark canvas. It's a magical moment, a daily ritual of nature.",
    "Amidst the chaos of the city, a lone musician plays a soulful tune on his guitar. People rush past, but for a moment, they pause, captivated by the music. The city, usually relentless, softens its edges. Music, the universal language, bridges the gaps between strangers, creating a brief connection in the urban hustle.",
    "In the forest, shadows dance as sunlight filters through the canopy. A stream gurgles nearby, its water clear and inviting. The air is filled with the earthy scent of moss and damp soil. Trees stand tall, their branches intertwined like old friends. Nature's symphony plays, from the rustling leaves to the distant calls of wildlife. It's a sanctuary, untouched by the urban clamor.",
    "Rain falls in rhythmic patterns, tapping gently on rooftops and leaves. Puddles form, reflecting the world like mirrors. The scent of wet earth rises, refreshing and invigorating. Umbrellas open like colorful flowers in bloom, creating a sea of protection against the downpour. Rain, a cleansing force, transforms the ordinary into something extraordinary.",
    "The waves crash against the shore, a relentless dance between land and sea. Seagulls soar overhead, their cries echoing the rhythm of the tides. Footprints in the sand tell stories of those who've walked this beach before. Shells and seaweed decorate the shoreline, nature's gifts waiting to be discovered. The beach, a timeless meeting place for earth and ocean.",
    "Mountains stand tall, their peaks kissed by snow. Valleys below cradle rivers that carve through the rugged terrain. Hiking trails wind through the landscape, inviting adventurers to explore. The air grows thinner as altitude increases, a reminder of the majesty and challenges these peaks pose. Mountains, silent sentinels, witnesses to the passage of time.",
    "Dusk settles over the city, and lights begin to twinkle like stars on the ground. Skyscrapers create a dazzling skyline, a testament to human ingenuity. Traffic hums below, a symphony of movement. The city, a vibrant tapestry of stories and dreams woven into its streets.",
    "The desert stretches endlessly, a sea of sand dunes under the scorching sun. Heatwaves create illusions on the horizon, a mirage of oasis that disappears upon approach. Cacti stand resilient, their needles defying the harsh conditions. The desert, a realm of extremes, where life adapts to survive.",
    "Jungle foliage forms a lush canopy, sunlight filtering through in golden rays. Vibrant flowers bloom, attracting butterflies with their colors. Monkeys swing from vines, their playful antics echoing through the green expanse. The jungle, a vibrant ecosystem where every creature plays a vital role in the intricate dance of life.",
    "The meadow stretches out, a carpet of wildflowers in a myriad of colors. Bees buzz from bloom to bloom, collecting nectar. Butterflies dance on the gentle breeze, their delicate wings carrying them from one petal to another. The meadow, a haven for pollinators and a spectacle of nature's artistry.",
    "Canyon walls rise dramatically, their layers telling a geological tale. A river flows below, carving through the stone with persistent determination. Echoes bounce off the cliffs, creating a natural amphitheater. The canyon, a testament to the power of erosion and the beauty it leaves behind.",
    "The city park buzzes with activity as families enjoy picnics on the grass. Children's laughter mingles with the calls of birds. A fountain in the center adds a soothing backdrop, its water glistening in the sunlight. The park, a communal oasis where people come together to escape the urban hustle.",
    "Autumn leaves fall in a cascade of red, orange, and yellow. The air is crisp, carrying the scent of decaying foliage. Squirrels scurry, collecting nuts for the winter ahead. The season, a time of transition, as nature sheds its vibrant summer cloak for a more subdued palette.",
    "Snow blankets the landscape, transforming it into a winter wonderland. Footprints mark the paths of those who venture into the cold embrace. The air is silent, insulated by the softness of snow. Trees wear a coat of white, their branches glistening in the pale sunlight. Winter, a season of stillness and beauty.",
    "Stars glitter in the night sky, forming constellations that have captivated humans for centuries. The moon hangs like a luminous pearl, casting a gentle glow. A sense of awe and wonder fills the air, as if the universe itself is whispering its secrets. The night, a canvas of celestial artistry.",
    "A garden blooms with a riot of colors, petals unfurling like delicate secrets. Bees hover, drawn to the sweet fragrance. Gardening tools clink as they meet the soil, a labor of love and patience. The garden, a testament to the harmony between human hands and nature's cycles.",
    "Thunder rumbles, and lightning streaks across the sky, illuminating the darkness. Rain pours in sheets, refreshing the earth. Puddles form, reflecting the stormy drama above. Nature's fury, a reminder of the unpredictable power that coexists with serene moments.",
    "A train rumbles along the tracks, its whistle announcing its presence. Commuters bustle on and off, each lost in their own thoughts. The platform is a transient space, a junction of lives briefly intersecting before diverging once more. The train station, a microcosm of the perpetual movement of city life.",
    "A café hums with activity, the aroma of coffee wafting through the air. Baristas create intricate designs in the foam of lattes. Conversations blend into a steady murmur, a backdrop to the clinking of cups and saucers. The café, a sanctuary for those seeking a moment of respite in the midst of the daily grind.",
    "A library is a sanctuary of knowledge, shelves lined with books that hold worlds within their pages. The hushed whispers of readers create a symphony of learning. Sunlight filters through windows, casting a warm glow on quiet corners. The library, a refuge for those seeking solace and exploration in the boundless realms of literature."
];

let numerParagraph = [
    "in a garden with 3 roses and 2 daisies there are 4 butterflies fluttering around a bush 5 bees buzz near a hive while 6 ants crawl across the ground 7 trees provide shade casting shadows on the grass 8 birds chirp in harmony exchanging melodies as the sun shines 9 clouds drift lazily their shapes creating patterns in the sky 10 flowers bloom and 11 petals fall in the gentle breeze 12 frogs croak in a pond each adding to the symphony of nature 13 raindrops fall slowly their sound blending with the rustling leaves 14 sunbeams break through the clouds and 15 rainbows paint the horizon 16 fish swim in a pond each moving with the flow of the water 17 stones skip across the surface creating ripples in the pond 18 leaves rustle in the wind each dancing to its own rhythm 19 crickets chirp in the evening their chorus signaling the approaching night",
    "in a room with 3 windows and 2 doors there are 4 chairs around a table 5 books sit on a shelf while 6 cups are scattered across the floor 7 lamps illuminate the space casting shadows on the walls 8 people stand in silence exchanging glances as the clock ticks 9 phones buzz simultaneously their screens displaying messages and missed calls 10 minutes pass and 11 voices break the stillness discussing plans for the day 12 ideas float in the air each competing for attention in the chaos 13 seconds later the room erupts with laughter and 14 smiles light up the room",
    "in a kitchen with 3 windows and 2 doors there are 4 plates on a table 5 utensils rest in a drawer while 6 cups are neatly arranged in a cupboard 7 pots hang from hooks casting shadows on the walls 8 chefs stand in concentration exchanging glances as they prepare meals 9 spices sit on a shelf their aromas blending in the air 10 minutes pass and 11 timers beep signaling the completion of dishes 12 flavors meld together in a culinary masterpiece each ingredient playing a role 13 ovens hum in unison their warmth filling the room 14 smells waft through the air enticing appetites 15 ingredients are chopped mixed and stirred in a synchronized dance 16 sizzles and bubbling sounds create a symphony in the kitchen 17 ingredients are plated each dish a work of art in its own right 18 servers move with precision delivering dishes to awaiting tables 19 customers savor each bite their faces lighting up with delight",
    "in a classroom with 3 chalkboards and 2 windows there are 4 desks arranged in rows 5 textbooks sit on a shelf while 6 pencils are scattered across the floor 7 students sit in silence exchanging glances as the teacher speaks 8 notebooks open and close capturing thoughts and ideas 9 pens scribble simultaneously filling pages with notes and doodles 10 lessons pass and 11 questions break the quiet sparking discussions 12 concepts float in the air each student grappling with understanding 13 seconds later the classroom erupts with laughter and 14 smiles light up the space",
    "in a park with 3 benches and 2 pathways there are 4 squirrels playing around a tree 5 joggers run on a trail while 6 dogs are happily chasing each other 7 children swing on swings casting shadows on the playground 8 birds chirp in the background exchanging songs in the trees 9 leaves rustle in the breeze creating a soothing melody 10 moments pass and 11 families break the calm engaging in picnics and games 12 kites soar in the sky each one a colorful dot against the blue backdrop 13 moments later the park echoes with laughter and 14 smiles light up the green surroundings",
    "in a library with 3 bookshelves and 2 study tables there are 4 readers engrossed in books 5 librarians organize shelves while 6 pens are scattered across the study area 7 lamps illuminate the space casting shadows on the bookcases 8 pages turn in silence exchanging stories and knowledge 9 bookmarks mark pages simultaneously keeping track of literary journeys 10 hours pass and 11 discussions break the quiet exploring literary realms 12 ideas float in the air each book a portal to a different world 13 moments later the library hums with whispers and 14 smiles light up the readers' faces",
    "in a gym with 3 treadmills and 2 weight benches there are 4 athletes working out 5 trainers guide their routines while 6 water bottles are scattered across the floor 7 music blares from speakers casting a rhythm in the air 8 weights clang in the background exchanging sounds of strength 9 pulses race simultaneously their beats echoing in the space 10 sets pass and 11 grunts break the intensity pushing through limits 12 energy floats in the air each athlete focused on their fitness journey 13 seconds later the gym resonates with cheers and 14 smiles light up the faces of those achieving personal goals",
    "in a beach with 3 palm trees and 2 sandcastles there are 4 surfers riding waves 5 seagulls soar in the sky while 6 shells are scattered across the shoreline 7 waves crash on the sand casting patterns on the beach 8 sunbathers lay in stillness exchanging glances as they relax 9 seashells collect simultaneously their shapes creating a mosaic on the shore 10 hours pass and 11 picnics break the tranquility adding life to the scene 12 ideas float in the air each wave bringing a new story 13 moments later the beach echoes with laughter and 14 smiles light up the sandy surroundings",
    "in a factory with 3 conveyor belts and 2 assembly lines there are 4 workers assembling products 5 machines hum in the background while 6 tools are neatly arranged on a table 7 products move on the belts casting shadows on the floor 8 workers focus in concentration exchanging glances as they work 9 noises fill the space simultaneously their sounds creating a symphony of industry 10 hours pass and 11 shifts break the rhythm changing the dynamics 12 ideas float in the air each worker contributing to the final output 13 seconds later the factory resonates with the buzz and 14 smiles light up the faces of those accomplishing production goals",
    "in a city with 3 skyscrapers and 2 bridges there are 4 taxis navigating the streets 5 pedestrians walk on sidewalks while 6 bikes are scattered near a park 7 cars honk in the distance casting echoes in the urban jungle 8 streetlights illuminate the roads exchanging glances with the city's pulse 9 billboards flash simultaneously their messages competing for attention 10 hours pass and 11 meetings break the routine shaping the city's future 12 ideas float in the air each building a testament to progress 13 moments later the city buzzes with activity and 14 smiles light up the faces of those shaping the urban landscape",
    "in a concert hall with 3 stages and 2 dressing rooms there are 4 musicians tuning their instruments 5 stagehands move in the background while 6 posters are scattered across the floor 7 lights shine on the stages casting shadows on the curtains 8 performers stand in anticipation exchanging glances as they prepare 9 instruments play simultaneously their notes creating a harmonious melody 10 moments pass and 11 performances break the stillness captivating the audience 12 ideas float in the air each note a brushstroke on the canvas of sound 13 seconds later the hall echoes with applause and 14 smiles light up the faces of those creating musical magic"
]

let mixParagraphs = [
    "In a room with 3 windows and 2 doors, there are 4 chairs around a table. 5 books sit on a shelf, while 6 cups are scattered across the floor. 7 lamps illuminate the space, casting shadows on the walls. 8 people stand in silence, exchanging glances as the clock ticks. 9 phones buzz simultaneously, their screens displaying messages and missed calls. 10 minutes pass, and 11 voices break the stillness, discussing plans for the day. 12 ideas float in the air, each competing for attention in the chaos. 13 seconds later, the room erupts with laughter, and 14 smiles light up the room.",
    "Three friends embarked on a journey. They walked for 10 miles, crossing 3 rivers and climbing 7 hills. Along the way, they found 2 caves and explored each one. Inside, they discovered a treasure chest with a map and directions to a hidden island. Excitement filled their hearts as they realized the adventure that awaited them. They traveled for 8 more days, encountering various challenges but overcoming them with teamwork. On the 19th day, they reached the island, where they found a paradise with lush landscapes and 10 waterfalls cascading down the mountains.",
    "On the 12th floor of a skyscraper, a scientist conducted experiments. The laboratory contained 15 workstations, each equipped with cutting-edge equipment. The scientist focused on analyzing 20 different samples, noting observations and measurements. The experiments aimed to discover patterns in the data, with the ultimate goal of solving complex problems. The research team, consisting of 30 members, collaborated on groundbreaking projects. They presented their findings at conferences attended by 100 experts from various fields. The scientific community recognized their contributions, leading to the publication of 7 research papers in prestigious journals.",
    "A classroom buzzed with activity as 30 students worked on a math competition. The questions ranged from basic arithmetic to advanced calculus, challenging their mathematical prowess. They had 90 minutes to solve 50 problems, and the top three scorers would receive medals. The atmosphere was intense, with pencils scribbling on paper and minds racing against the clock. When the time was up, the teacher collected the answer sheets. The scores ranged from 15 to 49, showcasing the diverse skill levels of the participants. The competition became an annual event, attracting more students eager to test their mathematical abilities.",
    "A cityscape boasts 184 skyscrapers, their silhouettes reaching toward the sky. 185 vehicles navigate the streets, creating a symphony of honks and engine sounds. 186 pedestrians cross bustling intersections, their hurried pace blending with the urban rhythm. 187 stores line the sidewalks, their windows displaying a myriad of products. 188 cafes offer a respite for tired city dwellers, their aroma of coffee enticing. 189 minutes later, the city lights twinkle, and 190 stories unfold in the tapestry of urban life.",
    "A hotel lobby welcomes 110 guests, each with unique stories. 111 rooms offer comfort and amenities, inviting weary travelers to rest. 112 staff members ensure a pleasant stay, from check-in to check-out. 113 elevators transport guests to their floors, gliding silently. 114 keys unlock the doors to cozy rooms, a temporary home. 115 minutes pass, and the hotel bustles with activity. 116 conversations unfold, creating a dynamic atmosphere. 117 hours later, the lobby empties as guests head out to explore the city.",
    "A train departs from platform 15, carrying passengers to destinations unknown. 16 carriages follow, each filled with a mix of faces. 17 stops lie ahead, marked by signs along the tracks. 18 minutes into the journey, announcements blare through the speakers, providing updates on the trip. 19 passengers check their watches, while 20 others lose themselves in books and newspapers. 21 stations pass by, a blur of scenery outside the windows. 22 conversations unfold simultaneously, creating a symphony of voices. 23 hours later, the train arrives at its final destination, and 24 tired but satisfied travelers disembark."
]

let randomParagraph = (paragraph) => {
    let concutpara = "";
    for( let i = 1; i <= getSetting()[2]; i++) {
        let ranIndex = Math.floor(Math.random() * paragraph.length);
        if( i > 1 ) {
            concutpara += " ";
        }
        concutpara += paragraph[ranIndex];
    }
    return concutpara.split(" ");
}

let wordArray = [],
page = document.querySelector(".page"),
timeTag = document.querySelector(".time_tag"),
timer,
timeLeft,
freshValue = true,
wpmValue = 0;



let createActiveParagraph = (splitedParagraph) => {
    page.textContent = "";
    let i = 1,
    n = 0;
    splitedParagraph.map(word => {
        let wordSpan = document.createElement("span");
        let spaceSpan = document.createElement("i");
        spaceSpan.classList.add("toactive");
        spaceSpan.textContent = " ";
        wordArray.push([]);
        word.split("").map( letter => {
            let letterSpan = document.createElement("span");
            letterSpan.classList.add("toactive");
            letterSpan.textContent = letter;
            wordArray[wordArray.length - 1].push(letterSpan);
            if( i == 1 ) {
                letterSpan.classList.add("one");
                letterSpan.id = "active";
            }
            i++;
        })
        wordArray[wordArray.length - 1].map( span => wordSpan.appendChild(span));
        wordSpan.classList.add(`word_span${n}`);
        n++;
        page.appendChild(wordSpan);
        page.appendChild(spaceSpan);
    })
    document.getElementById("inputField").focus();
}


let df = [ false, false, 4, 0];
let getSetting = () => {
    return JSON.parse(localStorage.getItem("setting")) || df;
}

//localStorage.setItem("setting", JSON.stringify(df));

let resnum = 1;

let checkSetting = () => {
    wordArray = [];
    wpmValue = 0;
    wordcount = lettercount = activecount = mistake = 0;
    timeLeft = 15 * getSetting()[2];
    timeTag.textContent = `${timeLeft}s`;
    document.querySelector(".page").textContent= "";
    if( !(getSetting()[0]) && !(getSetting()[1]) ) {
        createActiveParagraph(randomParagraph(normalParagraphs));
    } else if ( getSetting()[0] && getSetting()[1] ) {
        createActiveParagraph(randomParagraph(mixParagraphs));
    } else if ( getSetting()[0] && !(getSetting()[1]) ) {
        createActiveParagraph(randomParagraph(panctuParagraphs));
    } else {
        createActiveParagraph(randomParagraph(numerParagraph));
    }
    let levels = document.querySelectorAll(".lv");
    let i = 1;
    levels.forEach( level => {
        if ( i == getSetting()[2] ) {
            level.classList.add("active_color");
        } else {
            level.classList.remove("active_color");
        }
        i = i + i;
    })
    resnum = 1;
    clearInterval(timer);
    freshValue = false;
    setTimeout( _ => freshValue = true , 1000);
}

let checkHight = () => {
    document.querySelector(".top_score>span").textContent = `${getSetting()[3]} WPM`;
}

if(getSetting()[0]) {
    document.querySelector(".punct").classList.toggle("active_color");
}
if(getSetting()[1]) {
    document.querySelector(".numb").classList.toggle("active_color");
}

checkSetting();
checkHight();


let wordSpanAll = document.querySelectorAll(".page>span");
let toactive = document.querySelectorAll(".toactive");
    
wordcount = lettercount = activecount = mistake = 0;

let saveTiming = num => {
    let resault = getSetting();
    resault[2] = num;
    localStorage.setItem("setting", JSON.stringify(resault));
    checkSetting();
    wordSpanAll = document.querySelectorAll(".page>span");
    toactive = document.querySelectorAll(".toactive");
}
document.querySelector(".l1").onclick = _ => {
    saveTiming(1);
}
document.querySelector(".l2").onclick = _ => {
    saveTiming(2);
}
document.querySelector(".l3").onclick = _ => {
    saveTiming(4);
}
document.querySelector(".l4").onclick = _ => {
    saveTiming(8);
}


document.querySelector(".fa-arrow-rotate-right").onclick = _ => {
    checkSetting();
    page.focus();
    wordSpanAll = document.querySelectorAll(".page>span");
    toactive = document.querySelectorAll(".toactive");
}

let saveSetting = _ => {
    let resault = getSetting();
    resault[0] = document.querySelector(".punct").classList.contains("active_color");
    resault[1] = document.querySelector(".numb").classList.contains("active_color");
    localStorage.setItem("setting", JSON.stringify(resault));
    checkSetting();
    wordSpanAll = document.querySelectorAll(".page>span");
    toactive = document.querySelectorAll(".toactive");
}

document.querySelector(".punct").onclick = _ => {
    document.querySelector(".punct").classList.toggle("active_color");
    saveSetting();
}

document.querySelector(".numb").onclick = _ => {
    document.querySelector(".numb").classList.toggle("active_color");
    saveSetting();
}

let positionActive = _ => {
    let active = document.getElementById("active");
    let resault = active.getBoundingClientRect();
    return resault.y;
}

let firstPosition = "";

let responsiveType = (nowEl) => {
    if ( firstPosition - positionActive() == 0 ) {
        nowEl.classList.add("one");
        console.log(1)
    } else if ( positionActive() - firstPosition > 35  && positionActive() - firstPosition < 70 ) {
        nowEl.classList.add("two");
        console.log(2)
    } else {
        let one = document.querySelectorAll(".one");
        let two = document.querySelectorAll(".two");
        one.forEach( el => el.remove());
        two.forEach( el => {
            el.classList.remove("two");
            el.classList.add("one");
        });
        nowEl.classList.add("two");
        console.log(3);
    }
}


document.getElementById("inputField").onkeydown = a => {
    if( a.key == "Enter") {
        return;
    }
    if( a.key == "Backspace") {
        if ( !(wordcount == 0 && lettercount == 0)) {
            if( document.querySelectorAll( `.span${wordcount}` ).length > 0 ) {
                mistake--;
                document.querySelectorAll( `.span${wordcount}` )[document.querySelectorAll( `.span${wordcount}` ).length - 1].remove();
                return;
            } else if ( lettercount < 1 ) {
                wordcount--;
                lettercount = wordArray[wordcount].length;
                toactive[activecount].id = "";
                activecount--;
                toactive[activecount].id = "active";
                responsiveType(toactive[activecount]);
                return;
            } else {
                lettercount--;
                toactive[activecount].id = "";
                activecount--;
                toactive[activecount].id = "active";
                responsiveType(toactive[activecount]);
                if(wordSpanAll[wordcount].children[lettercount].classList.contains("false")) {
                    mistake--;
                }
                
                wordSpanAll[wordcount].children[lettercount].classList.remove("true", "false");
                return;
            }
        } else {
            return;
        }

    } else {
        if( a.key == "Alt" || a.key == "Shift" || a.key == "Control" || a.key == "CapsLock" || a.key == "ContextMenu" || a.key == "Escape" || a.key == "Unidentified" || a.key == "Delete" || a.key == "Home" || a.key == "PageUp" || a.key == "PageDown" || a.key == "End" || a.key == "ArrowRight" || a.key == "ArrowUp" || a.key == "ArrowLeft" || a.key == "ArrowDown") {
            return;
        }
        if( resnum == 1 ) {
            firstPosition = positionActive();
            timer = setInterval(initTimer, 1000);
            resnum++;
        }

        if (lettercount == wordArray[wordcount].length ) {
            if( a.key == " " ) {
                let t = 0;
                let activeWord = document.querySelectorAll(`.word_span${wordcount}>span`)
                activeWord.forEach( span => {
                    if( span.classList.contains("false")) {
                        ;
                    } else {
                        t++;
                        if( t == activeWord.length ) {
                            wpmValue++;
                        }
                    }
                })
                wordcount++;
                lettercount = 0;
                activecount++;
                toactive[activecount - 1].id = "";
                toactive[activecount].id = "active";
                responsiveType(toactive[activecount]);
                return;
            } else {
                let extraspan = document.createElement("span");
                mistake++;
                extraspan.classList.add("false", `span${wordcount}`);
                extraspan.textContent = a.key;
                wordSpanAll[wordcount].appendChild(extraspan);
                return;
            }
        } 
        if( a.key == wordArray[wordcount][lettercount].textContent) {
            wordSpanAll[wordcount].children[lettercount].classList.add("true");
            toactive[activecount].id = "";
        } else {
            mistake++;
            wordSpanAll[wordcount].children[lettercount].classList.add("false");
            toactive[activecount].id = "";
        }
        lettercount++;
        activecount++;
    }
    toactive[activecount].id = "active";
    responsiveType(toactive[activecount]);
};

let initTimer = _ => {
    if( timeLeft > 0 ) {
        timeLeft--;
        timeTag.textContent = `${timeLeft}s`;
    } else {
        clearInterval(timer);
        showResault();
    }
}

let showResault = _ => {
    document.querySelector('.resault').style.display = "flex";
    document.querySelector(".testing").style.display = "none";
    let calculator = _ => {
        let resaulti = 0;
        if( getSetting()[2] == 1 ) {
            return resaulti = wpmValue * 4;
        } else if ( getSetting()[2] == 2) {
            return resaulti = wpmValue * 2;
        } else if ( getSetting()[2] == 4 ) {
            return resaulti = wpmValue;
        } else {
            return resaulti = wpmValue / 2;
        }
    }
    let WPM = calculator();
    document.querySelector('.wpm').textContent = WPM;
    document.querySelector(".mistake").textContent = mistake;
    if( WPM > getSetting()[3] ) {
        let resault = getSetting();
        resault[3] = WPM;
        localStorage.setItem("setting", JSON.stringify(resault));
        checkHight();
    }
}

document.querySelector(".restart").onclick = _ => {
    document.querySelector('.resault').style.display = "none";
    document.querySelector(".testing").style.display = "block";
    document.querySelector(".fa-arrow-rotate-right").onclick();
    document.querySelector(".tostart").onclick();
}

document.getElementById("inputField").addEventListener("blur", _ => {
    setTimeout( _ => {
        if(freshValue) {
            document.querySelector(".tostart").style.display = "block";
            document.querySelector(".page").style.opacity = 0.3;
        }
    }, 500)
});

document.querySelector(".tostart").onclick = _ => {
    document.getElementById("inputField").focus();
    document.querySelector(".tostart").style.display = "none";
    document.querySelector(".page").style.opacity = 1;
    freshValue = false;
    setTimeout( _ => freshValue = true , 1000);
};